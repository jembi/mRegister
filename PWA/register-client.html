<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client Registration</title>

  <!-- PWA: Manifest, Theme & Icons -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3367D6" />
  <link rel="icon" type="image/png" href="icon-192.png" sizes="192x192" />

  <!-- CSS: Consider purging and minifying -->
  <link href="styles.css" rel="stylesheet" />
  <link href="app.css" rel="stylesheet" />
</head>

<body>
  <div id="netStatus" style="
  position: fixed;
  top: 10px;
  right: 10px;
  background-color: #f0f0f0;
  padding: 3px 5px;
  border-radius: 4px;
  font-weight: bold;
  z-index: 9999;"></div>

  <div id="myFormContainer"></div>

  <!-- JS Dependencies (deferred to avoid blocking) -->
  <script src="zone.min.js" defer></script>
  <script src="lhc-forms.js" defer></script>
  <script src="lformsFHIR.min.js" defer></script>

  <script type="module">
    function updateStatus(isOnline) {
      const statusEl = document.getElementById("netStatus");
      if (statusEl) {
        statusEl.textContent = isOnline ? "ðŸŸ¢ Online" : "ðŸ”´ Offline";
        statusEl.style.backgroundColor = isOnline ? "#d4edda" : "#f8d7da";
        statusEl.style.color = isOnline ? "#155724" : "#721c24";
      }
    }

    window.addEventListener("online", () => updateStatus(true));
    window.addEventListener("offline", () => updateStatus(false));

    // Initial status on load
    updateStatus(navigator.onLine);

    
    // FHIRFormHandler initialization
    import { FHIRFormHandler } from './modules/fhirFormWeb.js';

    const fhirServerUrl = 'http://192.168.100.24:5001/QR-to-Patient';

    window.addEventListener('DOMContentLoaded', async () => {
      try {
        const formHandler = new FHIRFormHandler(
          'myFormContainer',
          './questionnaires/questionnaire-client-reg-schema.json',
          [],
          fhirServerUrl
        );

        window.__fhirServerUrl = fhirServerUrl;

        await formHandler.init();
      } catch (err) {
        console.error("Error initializing form:", err);
        alert("Failed to load form. Please try again later.");
      }
    });
  </script>
</body>

</html>